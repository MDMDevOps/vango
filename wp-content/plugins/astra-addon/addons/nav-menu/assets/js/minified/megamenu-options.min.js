!function(r){AstMegaMenuAdmin={init:function(){r(document).ready(this._ready).on("click",".astra-megamenu-opts-btn",this._openSettingsModal).on("click",".astra-mm-modal-overlay, .astra-megamenu-cancel-btn, .astra-mm-options-wrap .astra-mm-close ",this._closeSettingsModal).on("click",".astra-megamenu-save-opts",this._saveMegamenuOptions).on("click",".astra-builder-upload-button",this._openMediaUploader).on("click",".ast-remove-button",this._removeUploadButton).on("change",".field-mm-enabled input",this._megaMenuOptionDependency).on("change",".field-mm-enabled-heading input",this._megaMenuHeadingOptionDependency).on("change",".ast-content-src",this._contentOptDependency).on("change",".field-mm-disable-label input",this._disableLabelOptionDependency).on("click",".ast-insert-widget",this._dropWidget).on("click",".astra-mm-options-wrap .widget-action",this._editWidget)},_openSettingsModal:function(){var t=r(this),a=(t.closest("div").find(".astra-mm-modal-overlay"),t.parents(".menu-item-settings")),e=t.closest("li.menu-item"),i=e.attr("class").split(" "),s=parseInt(e.attr("id").match(/[0-9]+/)[0],10),n=e.find(".ast-nonce-field").val(),d=r(".ast-popup-wrap"),o=e.find(".menu-item-title").text(),l=d.find(".ast-megamenu-spinner.spinner"),m=r(".astra-mm-options-wrap");r("html").css("overflow","hidden"),$popup_menu_item=d.data("menu_item"),l.addClass("is-active"),AstMegaMenuAdmin._addDepthClass(i);e=t.parents(".menu-item").prevAll(".menu-item-depth-0").attr("id"),i=null;if(void 0!==e&&(i=e.replace(/[^0-9\.]/g,"")),s==$popup_menu_item)return l.removeClass("is-active"),d.css("display","flex"),void d.find(".astra-mm-options-wrap, .astra-mm-modal-overlay").show();d.find(".astra-mm-options-wrap div").css("visibility","hidden");n={action:"ast_render_popup",menu_item_id:s,parent_id:i,security_nonce:n};d.css("display","flex"),d.find(".astra-mm-options-wrap, .astra-mm-modal-overlay").show(),r.post(ajaxurl,n,function(e){e=e.data;l.removeClass("is-active"),d.find("astra-mm-options-wrap div").css("visibility","visible"),r(".ast-popup-wrap .astra-mm-options-wrap").html(e);e=r(".ast-editing-label").data("label")+" "+o;r(".ast-editing-label").text(e),r(".ast-popup-wrap .astra-mm-options-wrap").data("menu-item",s),AstMegaMenuAdmin._initSelect2(m),m.find(".astra-wp-color-input").wpColorPicker(),AstMegaMenuAdmin._contentOptDependency(t,m),r(a).addClass("ast-active"),d.data("loaded",!0),d.data("menu_item",s),AstMegaMenuAdmin._renderSavedWidgets(m,s)})},_addDepthClass:function(e){for(var t="",a=0;a<e.length;a++){var i=/^menu-item\-(.+)/.exec(e[a]);null==i||-1!==(i=i[1]).indexOf("depth")&&(t="menu-item-"+i)}r(".astra-mm-options-wrap").removeClass(function(e,t){return(t.match(/\bmenu-item-depth\S+/g)||[]).join(" ")}),r(".astra-mm-options-wrap").addClass(t)},_openMediaUploader:function(e){e.preventDefault();var t=r(this).data("id"),a=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",function(){var e=a.state().get("selection").first().toJSON();r("#edit-menu-item-megamenu-"+t).val(e.url),r("#astra-media-img-"+t).attr("src",e.url).css("display","block"),r("#astra-media-img-"+t).parents(".ast-media-img-container").addClass("ast-image-set")}).open()},_closeSettingsModal:function(){r("html").css("overflow","unset"),r(".menu-item-settings").removeClass("ast-active"),r(".astra-mm-modal-overlay").hide(),r(".astra-mm-options-wrap").hide(),r(".ast-popup-wrap").hide(),r(".ast-popup-wrap").find(".spinner").removeClass("is-active")},_initSelect2:function(e){e.find(".ast-select2-container").astselect2({placeholder:astMegamenuVars.select2_placeholder,ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data:function(e){return{q:e.term,page:e.page,action:"ast_get_posts_list",nonce:astRules.ajax_nonce}},processResults:function(e){return{results:e}},cache:!0},minimumInputLength:2,language:astRules.ast_lang})},_removeUploadButton:function(){var e=r(this).parents(".ast-media-img-container");e.find("img").attr("src",""),e.find(".astra-builder-upload-field").val(""),e.removeClass("ast-image-set")},_megaMenuHeadingOptionDependency:function(){var e=r(this),t=e.prop("checked"),a=r(".field-mm-header-sep-color");t?e.parents(".astra-mm-options-wrap").hasClass("menu-item-depth-0")||a.show():a.hide()},_megaMenuOptionDependency:function(){var e=r(this),t=e.prop("checked"),a=r(".field-mm-megamenu-opts .field-mm-width"),i=r(".bg-image-container, .field-mm-color"),s=r(".field-mm-content-src");t?(a.show(),i.show(),e.parents(".astra-mm-options-wrap").hasClass("menu-item-depth-0")||s.show()):(a.hide(),i.hide(),s.hide())},_disableLabelOptionDependency:function(){var e=r(this).prop("checked"),t=r(".field-mm-disable-link");e?t.hide():t.show()},_contentOptDependency:function(e,t){var a,i;switch(r(".field-mm-template").hide(),r(".field-mm-custom-text").hide(),r(".field-mm-widget-option").hide(),r(".field-mm-widget-area").hide(),i=void 0!==t?(a=t.find(".ast-content-src").val(),t.find(".ast-mm-settings")):(a=r(this).val(),r(this).closest(".ast-mm-settings")),a){case"template":i.find(".field-mm-template").show();break;case"custom_text":i.find(".field-mm-custom-text").show();break;case"widget":i.find(".field-mm-widget-option").show(),i.find(".field-mm-widget-area").show()}},_dropWidget:function(e){e.preventDefault();var t=r(this),a=r(".ast-select-widget").val(),i=t.closest(".astra-mm-options-wrap"),e=i.data("menu-item"),t=i.find(".ast-drop-widget-nonce").val();""!=a&&(r(".ast-widget-list").show(),t={action:"ast_add_widget",widget_id:a,menu_item_id:e,title:r(".ast-select-widget").find("option:selected").text(),security_nonce:t},r.post(ajaxurl,t,function(e){e=r(e.data);i.find(".ast-widget-list").append(e),r(".ast-select-widget").val("")}))},_editWidget:function(){var a=r(this).closest(".widget"),t=a.find(".widget-inner"),i=a.attr("id");a.toggleClass("menu-item-edit-active");var e={action:"ast_edit_widget",widget_id:i};a.hasClass("open")||a.data("loaded")?a.toggleClass("open"):r.post(ajaxurl,e,function(e){t.html(e.data),a.data("loaded",!0).toggleClass("open"),a.is("[id*=black-studio-tinymce]")&&bstw(a).deactivate().activate(),setTimeout(function(){r(document).trigger("widget-added",[a])},100),a.find(".delete").on("click",function(e){e.preventDefault();e=a.find(".ast-delete-widget-nonce").val(),e={action:"ast_delete_widget",widget_id:i,security_nonce:e};r.post(ajaxurl,e,function(e){a.remove()})}),a.find(".close").on("click",function(e){e.preventDefault(),a.toggleClass("open")}),a.find(".ast-save-widget").on("click",function(e){e.preventDefault();var e=a.find("form").serialize(),t=r(this);t.attr("disabled","disabled"),a.find(".spinner").css("visibility","visible"),r.post(ajaxurl,e,function(e){a.find(".spinner").css("visibility","hidden"),t.removeAttr("disabled")})})})},_renderSavedWidgets:function(a,e){e={action:"ast_render_widgets",menu_item_id:e,security_nonce:a.find(".ast-render-widgets-nonce").val()};r.post(ajaxurl,e,function(e){var t=e.data.html;e.data.has_widgets&&r(".ast-widget-list").show(),a.find(".ast-widget-list").html(t),r("#ast-widget-sortable").sortable(),r("#ast-widget-sortable").disableSelection()})},_saveMegamenuOptions:function(){var t=r(this),e=t.closest(".astra-mm-options-wrap"),a=e.data("menu-item"),i=r("#nav-menu-meta-object-id").val(),s=[],n=e.find(".ast-nonce-field").val();r(".astra-mm-cta-wrap .spinner").css("visibility","visible"),t.text(astMegamenuVars.saving_text),t.attr("disabled","disabled");var d={};e.find("select, textarea, input").each(function(){var e,t,a=r(this);0<a.closest(".astra-mm-settings-wrap").find(".ast-widget-list").length||a.hasClass("ast-nonce-field")||(e=a.attr("name"),t=a.val(),"checkbox"==a.attr("type")&&(a.is(":checked")||(t="")),"textarea"==a.tagName&&(t=r(this).text()),void 0!==e&&(d[e]=t))}),r("#ast-widget-sortable > .widget").each(function(){var e=r(this).index(),t=r(this).attr("id");s[e]=t});n={action:"ast_save_menu_options",menu_item_id:a,nav_id:i,widgets:s,options:d,security_nonce:n};r.post(ajaxurl,n,function(e){t.text(astMegamenuVars.saved_text),r(".astra-mm-cta-wrap .spinner").css("visibility","hidden"),setTimeout(function(){t.text(t.data("label")),t.removeAttr("disabled")},1e3)})}},AstMegaMenuAdmin.init()}(jQuery);